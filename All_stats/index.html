<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Data Table</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <div>
    <label for="search">Search by Name: </label>
    <input type="text" id="search" oninput="filterTable()" placeholder="Enter employee name">
  </div>
  <table id="employeeTable">
    <thead>
      <tr>
        <th>#</th>
        <!-- <th>ID</th> -->
        <!-- <th>Email</th> -->
        <th>Name</th>
        <th>Total Time</th>
        <th>Stopped</th>
      </tr>
    </thead>
    <tbody>
      <!-- Employee data will be dynamically inserted here -->
    </tbody>
  </table>

  <script>
    let employees = []; // To store the fetched employee data

    // Function to fetch data from the API and populate the table
    async function fetchEmployeeData() {
      try {
        let url = "https://api2.teamlogger.com/api/companies/278350e941c540cfb10c2010337f9385/reports_new2?startTime=1691346600000&endTime=1691432999000&dayStartCutOff=14400000&dayEndCutOff=14399999&suppressDetails=false&groupId=ALL"
        // let url = "https://api2.teamlogger.com/api/companies/278350e941c540cfb10c2010337f9385/report_view_accounts?light=true&onlyActive=true"
        const response = await fetch(url, {
          headers: {
            "accept": "application/json, text/plain, */*",
            "accept-language": "en-GB,en-US;q=0.9,en;q=0.8",
            "authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vaGlwZXJyLmNvbSIsInN1YiI6IjQwYzNmODExMmM4MDQ3MGM4YzlhNDc4OTRhZGVkMGU1IiwiYXVkIjoic2VydmVyIn0.p1fPED6o0HnhZhvJbkjJgz_Nkx64jozCyCu1IDUkBZk",
            "sec-ch-ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Google Chrome\";v=\"100\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "same-site",
            "Referer": "https://client.teamlogger.com/",
            "Referrer-Policy": "strict-origin-when-cross-origin"
            // Add the rest of the headers here
          },
          body: null,
          method: "GET"
        });

        respomse = await response.json();
        employees = respomse?.employeeTimeReport?.timeReportItems
        populateTable(employees); // Populate the table initially with all employees
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    // Function to populate the table with employee data
    function populateTable(data) {
      const tableBody = document.querySelector("#employeeTable tbody");
      tableBody.innerHTML = "";
    //   <td>${employee.id}</td>
    //   <td>${employee.email}</td>
    // <td>${employee.activeSecondsCount / 60}</td>
    // spanHours 
    // totalHours
    // onComputerHours
      data.forEach((employee, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index+1}</td>
          <td>${employee.title}</td>
          <td>${formatHoursToMinutes(employee.spanHours)} <br> ${formatHoursToMinutes(employee.totalHours)} <br> ${formatHoursToMinutes(employee.onComputerHours)}</td>
          <td>${employee.stopped}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    function getFormatedTime(time) {
        const sessionEndTime = new Date(time);
        const hours = sessionEndTime.getHours() > 12 ? sessionEndTime.getHours() - 12 : sessionEndTime.getHours();
        const minutes = sessionEndTime.getMinutes();
        const ampm = sessionEndTime.getHours() >= 12 ? "PM" : "AM";
        const endTimeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")} ${ampm}`;

        return endTimeStr;
    }
    function formatHoursToMinutes(decimalHours) {
      // Convert decimal hours to total minutes
      const totalMinutes = decimalHours * 60;

      // Extract hours and minutes from the totalMinutes
      const hours = Math.floor(totalMinutes / 60);
      const minutes = Math.round(totalMinutes % 60); // Use Math.round to handle rounding errors

      // Format hours and minutes to two-digit format
      const formattedHours = hours.toString().padStart(2, '0');
      const formattedMinutes = minutes.toString().padStart(2, '0');

      // Create the formatted string
      const formattedString = `${formattedHours}:${formattedMinutes}`;

      return formattedString;
    }

    // Function to filter the table based on the search input
    function filterTable() {
      const searchTerm = document.getElementById("search").value.trim().toLowerCase();
      const filteredEmployees = employees.filter(employee => {
        return employee.title.toLowerCase().includes(searchTerm);
      });
      populateTable(filteredEmployees);
    }

    // Call the function to fetch and populate data when the page loads
    fetchEmployeeData();
  </script>
</body>
</html>
